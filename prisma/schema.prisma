generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                                                               String                   @id @default(uuid())
  username                                                         String                   @unique
  rblx_id                                                          String                   @unique
  profile_picture                                                  String
  created_at                                                       DateTime                 @default(now())
  updated_at                                                       DateTime                 @updatedAt
  role                                                             UserRoles                @default(MEMBER)
  client_seed                                                      String
  last_login_ip                                                    String?
  last_login_at                                                    DateTime?
  
  referedBy                                                        String?
  referralLastUpdate                                               DateTime?
  referedByMm2                                                     String?

  balance                                                          Decimal                  @default(0) @db.Decimal(10, 2)

  
  totalXP                                                          Int                      @default(0)
  currentLevel                                                     Int                      @default(1)
  xpMultiplier                                                     Decimal                  @default(1.0) @db.Decimal(5, 2)

  userStatisticsId                                                 Int?                     @unique

  ampGiveawayWins                                                  AmpGiveaway[]            @relation("AmpGiveawayWinner")
  ampGiveawayEntries                                               AmpGiveawayEntry[]
  CoinflipGameHistory_CoinflipGameHistory_player1UsernameToUser    CoinflipGameHistory[]    @relation("CoinflipGameHistory_player1UsernameToUser")
  CoinflipGameHistory_CoinflipGameHistory_player2UsernameToUser    CoinflipGameHistory[]    @relation("CoinflipGameHistory_player2UsernameToUser")
  crashBets                                                        CrashBet[]               @relation("CrashBets")
  GameHistory                                                      GameHistory[]            @relation("GameHistory")
  kinguinCodesRedeemed                                             KinguinPromoCode[]       @relation("KinguinCodeRedemptions")
  kinguinRedemptionLogs                                            KinguinRedemptionLog[]   @relation("KinguinRedemptions")
  CoinflipGameHistoryMm2_CoinflipGameHistory_player1UsernameToUser Mm2CoinflipGameHistory[] @relation("CoinflipGameHistory_player1UsernameToUser")
  CoinflipGameHistoryMm2_CoinflipGameHistory_player2UsernameToUser Mm2CoinflipGameHistory[] @relation("CoinflipGameHistory_player2UsernameToUser")
  mm2GiveawayWins                                                  Mm2Giveaway[]            @relation("Mm2GiveawayWinner")
  mm2GiveawayEntries                                               Mm2GiveawayEntry[]
  userReferral                                                     Referral?                @relation("user_referral")
  referralUsageLogs                                                ReferralLog[]
  referralUsageLogsMm2                                             ReferralLogMm2[]
  userReferralMm2                                                  ReferralMm2?             @relation("user_referralmm2")
  seedRotationHistory                                              SeedRotationHistory[]    @relation("SeedRotationHistory")
  referedByUserMm2                                                 ReferralMm2?             @relation("user_refered_bymm2", fields: [referedByMm2], references: [referralCode])
  referedByUser                                                    Referral?                @relation("user_refered_by", fields: [referedBy], references: [referralCode])
  userGameStats                                                    UserGameStatistics[]     @relation("UserGameStats")
  inventory                                                        UserInventoryAmp[]
  inventoryMm2                                                     UserInventoryMm2[]
  userSeed                                                         UserSeed?                @relation("UserSeed")
  statistics                                                       UserStatistics?          @relation("UserStatisticsUser")
  settings                                                         UserSettings?            @relation("UserSettings")
  verifications                                                    UserVerification[]
  receivedTipTransactions                                          TipTransaction[]         @relation("TipTransactionRecipient")
  sentTipTransactions                                              TipTransaction[]         @relation("TipTransactionSender")
  balanceTipTransactions                                           BalanceTipTransaction[]  @relation("TipTransactionRecipient")
  sentBalanceTipTransactions                                       BalanceTipTransaction[]  @relation("TipTransactionSender")
  userDepositAddresses                                             UserDepositAddress[]
  transactionHistory                                               TransactionHistory[]

  @@index([username, rblx_id])
  @@index([totalXP(sort: Desc)])
  @@index([currentLevel(sort: Desc)])
}

model UserSettings {
  id             String  @id @default(uuid())
  userUsername   String  @unique
  // Privacy Settings
  privateProfile Boolean @default(false)
  showStatistics Boolean @default(true)
  // Preference Settings
  soundEffects   Boolean @default(true)
  soundVolume    Int     @default(70)
  animations     Boolean @default(true)
  language       String  @default("en")
  timezone       String  @default("UTC")

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation("UserSettings", fields: [userUsername], references: [username], onDelete: Cascade)

  @@index([userUsername])
}

model UserStatistics {
  id                Int       @id @default(autoincrement())
  userUsername      String    @unique
  // Overall Statistics
  totalWagered      Decimal   @default(0) @db.Decimal(12, 2)
  totalWageredMm2   Decimal   @default(0) @db.Decimal(12, 2)
  totalDeposits     Decimal   @default(0) @db.Decimal(12, 2)
  totalWithdrawals  Decimal   @default(0) @db.Decimal(12, 2)
  totalProfit       Decimal   @default(0) @db.Decimal(12, 2)
  totalLoss         Decimal   @default(0) @db.Decimal(12, 2)
  netProfit         Decimal   @default(0) @db.Decimal(12, 2)
  // Game Statistics
  totalGamesPlayed  Int       @default(0)
  totalGamesWon     Int       @default(0)
  totalGamesLost    Int       @default(0)
  coinflipsWon      Int       @default(0)
  coinflipsLost     Int       @default(0)
  crashGamesPlayed  Int       @default(0)
  minesGamesPlayed  Int       @default(0)
  // Win Statistics
  biggestWin        Decimal   @default(0) @db.Decimal(12, 2)
  biggestWinGame    String?
  biggestWinDate    DateTime?
  biggestMultiplier Decimal   @default(0) @db.Decimal(10, 4)
  highestCrashPoint Decimal   @default(0) @db.Decimal(10, 4)

  // Engagement Statistics
  giveawaysEntered      Int     @default(0)
  giveawaysWon          Int     @default(0)
  tipsReceived          Int     @default(0)
  tipsSent              Int     @default(0)
  totalTipValueReceived Decimal @default(0) @db.Decimal(10, 2)
  totalTipValueSent     Decimal @default(0) @db.Decimal(10, 2)

  // Metadata
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  user       User     @relation("UserStatisticsUser", fields: [userUsername], references: [username])

  @@index([userUsername])
  @@index([totalWagered(sort: Desc)])
  @@index([totalWageredMm2(sort: Desc)])
  @@index([netProfit(sort: Desc)])
  @@index([biggestWin(sort: Desc)])
}

model ipBans {
  id           Int       @id @default(autoincrement())
  ip_address   String
  banned_until DateTime?
  reason       String
  created_at   DateTime  @default(now())

  @@index([ip_address])
}

model UserVerification {
  id           Int      @id @default(autoincrement())
  userUsername String
  description  String
  key          String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userUsername], references: [username], onDelete: Cascade)

  @@index([userUsername])
  @@index([key])
}

model UserInventoryAmp {
  id             Int                    @id @default(autoincrement())
  userUsername   String
  petId          Int
  state          UserInventoryItemState
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  petInGameId    String
  value          Float
  petVariant     Variant[]
  owner_bot_id   Int
  botTradeStatus BotTradeStatus
  Bot            AmpBot                 @relation(fields: [owner_bot_id], references: [id], onDelete: Cascade)
  pet            pets                   @relation(fields: [petId], references: [id])
  user           User                   @relation(fields: [userUsername], references: [username], onDelete: Cascade)

  @@index([userUsername])
  @@index([petId])
  @@index([state])
  @@index([owner_bot_id])
  @@index([userUsername, id])
  @@index([id, userUsername])
  @@map("UserInventory")
}

model UserInventoryMm2 {
  id             Int                    @id @default(autoincrement())
  userUsername   String
  itemId         Int
  value          Decimal                @db.Decimal(10, 2)
  state          UserInventoryItemState
  owner_bot_id   Int
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  botTradeStatus BotTradeStatus
  item           Mm2Item                @relation(fields: [itemId], references: [id])
  Bot            Mm2Bot                 @relation(fields: [owner_bot_id], references: [id], onDelete: Cascade)
  user           User                   @relation(fields: [userUsername], references: [username], onDelete: Cascade)

  @@index([userUsername])
  @@index([itemId])
  @@index([state])
  @@index([owner_bot_id])
  @@index([userUsername, state])
}

model pets {
  id                Int                @id @default(autoincrement())
  name              String
  image             String
  rarity            String
  type              String
  rvalue            Float
  nvalue            Float
  mvalue            Float
  rvalue_nopotion   Float
  rvalue_ride       Float
  rvalue_fly        Float
  rvalue_flyride    Float
  nvalue_nopotion   Float
  nvalue_ride       Float
  nvalue_fly        Float
  nvalue_flyride    Float
  mvalue_nopotion   Float
  mvalue_ride       Float
  mvalue_fly        Float
  mvalue_flyride    Float
  category_d        String
  category_n        String
  category_m        String
  category_preppy_d Boolean            @default(false)
  category_preppy_n Boolean            @default(false)
  category_preppy_m Boolean            @default(false)
  is_flyride        Boolean            @default(false)
  score             Int                @default(0)
  created_at        DateTime           @default(now())
  updated_at        DateTime
  inGameName        String?
  giveaways         AmpGiveaway[]
  inventory         UserInventoryAmp[]

  @@index([name])
  @@index([rarity])
  @@index([type])
  @@index([score(sort: Desc)])
  @@index([name], map: "idx_pets_name")
}

model AmpBot {
  id                  Int                @id @default(autoincrement())
  name                String
  rblx_id             String             @unique
  private_server_link String
  profile_picture     String
  created_at          DateTime           @default(now())
  updated_at          DateTime           @default(now())
  active              Boolean
  banned              Boolean            @default(false)
  can_join            Boolean            @default(true)
  UserInventory       UserInventoryAmp[]

  @@index([name])
  @@index([active])
  @@index([rblx_id])
  @@map("Bot")
}

model Mm2Bot {
  id                  Int                @id @default(autoincrement())
  name                String
  rblx_id             String             @unique
  private_server_link String
  profile_picture     String
  banned              Boolean            @default(false)
  active              Boolean
  created_at          DateTime           @default(now())
  updated_at          DateTime           @default(now())
  can_join            Boolean            @default(true)
  UserInventory       UserInventoryMm2[]

  @@index([name])
  @@index([active])
  @@index([rblx_id])
}

model CoinflipGameHistory {
  id                                             Int                          @id @default(autoincrement())
  gameId                                         String                       @unique
  betAmount                                      Float
  player1Username                                String
  player2Username                                String
  winnerSide                                     Side
  player1Side                                    Side
  createdAt                                      DateTime                     @default(now())
  updatedAt                                      DateTime
  player1Items                                   Json
  player2Items                                   Json
  User_CoinflipGameHistory_player1UsernameToUser User                         @relation("CoinflipGameHistory_player1UsernameToUser", fields: [player1Username], references: [username])
  User_CoinflipGameHistory_player2UsernameToUser User                         @relation("CoinflipGameHistory_player2UsernameToUser", fields: [player2Username], references: [username])
  CoinflipGameProvablyFairity                    CoinflipGameProvablyFairity?

  @@index([player1Username])
  @@index([player2Username])
}

model CoinflipGameProvablyFairity {
  id                  Int                 @id @default(autoincrement())
  gameId              String              @unique
  serverSeed          String
  serverSeedHash      String
  clientSeed          String
  nonce               String
  result              String
  createdAt           DateTime            @default(now())
  player1Chance       String              @default("0.50")
  player2Chance       String              @default("0.50")
  CoinflipGameHistory CoinflipGameHistory @relation(fields: [gameId], references: [gameId])

  @@index([gameId])
}

model Mm2CoinflipGameHistory {
  id                                             Int                             @id @default(autoincrement())
  gameId                                         String                          @unique
  betAmount                                      Float
  player1Username                                String
  player2Username                                String
  winnerSide                                     Side
  player1Side                                    Side
  createdAt                                      DateTime                        @default(now())
  updatedAt                                      DateTime
  player1Items                                   Json
  player2Items                                   Json
  User_CoinflipGameHistory_player1UsernameToUser User                            @relation("CoinflipGameHistory_player1UsernameToUser", fields: [player1Username], references: [username])
  User_CoinflipGameHistory_player2UsernameToUser User                            @relation("CoinflipGameHistory_player2UsernameToUser", fields: [player2Username], references: [username])
  CoinflipGameProvablyFairity                    Mm2CoinflipGameProvablyFairity?

  @@index([player1Username])
  @@index([player2Username])
}

model Mm2CoinflipGameProvablyFairity {
  id                  Int                    @id @default(autoincrement())
  gameId              String                 @unique
  serverSeed          String
  serverSeedHash      String
  clientSeed          String
  nonce               String
  result              String
  createdAt           DateTime               @default(now())
  player1Chance       String                 @default("0.50")
  player2Chance       String                 @default("0.50")
  CoinflipGameHistory Mm2CoinflipGameHistory @relation(fields: [gameId], references: [gameId])

  @@index([gameId])
}

model Referral {
  id                     String        @id @default(uuid())
  userUsername           String        @unique
  referralCode           String        @unique
  isActive               Boolean       @default(true)
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  lastActivity           DateTime?
  lastClaim              DateTime?
  totalGenerated         Decimal       @default(0) @db.Decimal(10, 2)
  totalClaimed           Decimal       @default(0) @db.Decimal(10, 2)
  claimableAmount        Decimal       @default(0) @db.Decimal(10, 2)
  pendingAmount          Decimal       @default(0) @db.Decimal(10, 2)
  monthlyLimit           Decimal?      @db.Decimal(10, 2)
  lifetimeLimit          Decimal?      @default(5000.00) @db.Decimal(10, 2)
  minimumClaim           Decimal       @default(10.00) @db.Decimal(10, 2)
  commissionRate         Decimal       @default(0.02) @db.Decimal(5, 4)
  bonusMultiplier        Decimal       @default(1.0) @db.Decimal(3, 2)
  tier                   Int           @default(1)
  clickCount             Int           @default(0)
  conversionCount        Int           @default(0)
  conversionRate         Decimal       @default(0) @db.Decimal(5, 4)
  lastReferralCodeChange DateTime?
  ownerUser              User          @relation("user_referral", fields: [userUsername], references: [username], onDelete: Cascade)
  referralLogs           ReferralLog[]
  referredUsers          User[]        @relation("user_refered_by")

  @@index([userUsername])
  @@index([referralCode])
}

model ReferralLog {
  id               String   @id @default(uuid())
  referredUsername String
  game             String
  amount           Decimal  @default(0) @db.Decimal(10, 2)
  referrerCode     String
  createdAt        DateTime @default(now())
  referralMm2Id    String?
  referredUser     User     @relation(fields: [referredUsername], references: [username], onDelete: Cascade)
  referrer         Referral @relation(fields: [referrerCode], references: [referralCode], onDelete: Cascade)

  @@index([referrerCode])
}

model ReferralMm2 {
  id                     String           @id @default(uuid())
  userUsername           String           @unique
  referralCode           String           @unique
  isActive               Boolean          @default(true)
  createdAt              DateTime         @default(now())
  updatedAt              DateTime         @updatedAt
  lastActivity           DateTime?
  lastClaim              DateTime?
  totalGenerated         Decimal          @default(0) @db.Decimal(10, 2)
  totalClaimed           Decimal          @default(0) @db.Decimal(10, 2)
  claimableAmount        Decimal          @default(0) @db.Decimal(10, 2)
  pendingAmount          Decimal          @default(0) @db.Decimal(10, 2)
  monthlyLimit           Decimal?         @db.Decimal(10, 2)
  lifetimeLimit          Decimal?         @default(5000.00) @db.Decimal(10, 2)
  minimumClaim           Decimal          @default(10.00) @db.Decimal(10, 2)
  commissionRate         Decimal          @default(0.02) @db.Decimal(5, 4)
  bonusMultiplier        Decimal          @default(1.0) @db.Decimal(3, 2)
  tier                   Int              @default(1)
  clickCount             Int              @default(0)
  conversionCount        Int              @default(0)
  conversionRate         Decimal          @default(0) @db.Decimal(5, 4)
  lastReferralCodeChange DateTime?
  referralLogs           ReferralLogMm2[]
  ownerUser              User             @relation("user_referralmm2", fields: [userUsername], references: [username], onDelete: Cascade)
  referredUsers          User[]           @relation("user_refered_bymm2")

  @@index([userUsername])
  @@index([referralCode])
}

model ReferralLogMm2 {
  id               String      @id @default(uuid())
  referredUsername String
  game             String
  amount           Decimal     @default(0) @db.Decimal(10, 2)
  referrerCode     String
  createdAt        DateTime    @default(now())
  referredUser     User        @relation(fields: [referredUsername], references: [username], onDelete: Cascade)
  referrer         ReferralMm2 @relation(fields: [referrerCode], references: [referralCode], onDelete: Cascade)

  @@index([referrerCode])
}

model TipTransaction {
  id                String   @id @default(cuid())
  senderUsername    String
  recipientUsername String
  itemIds           String[]
  totalValue        Decimal  @db.Decimal(10, 2)
  itemCount         Int
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  recipient         User     @relation("TipTransactionRecipient", fields: [recipientUsername], references: [username])
  sender            User     @relation("TipTransactionSender", fields: [senderUsername], references: [username])

  @@map("tip_transactions")
}

model BalanceTipTransaction {
  id                String   @id @default(cuid())
  senderUsername    String
  recipientUsername String
  amount            Decimal  @db.Decimal(10, 2)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  recipient User @relation("TipTransactionRecipient", fields: [recipientUsername], references: [username])
  sender    User @relation("TipTransactionSender", fields: [senderUsername], references: [username])
}

model Mm2Item {
  id           Int                @id @default(autoincrement())
  name         String
  image        String
  category     String             @default("")
  rarity       String
  inGameName   String
  value        Decimal            @db.Decimal(10, 2)
  created_at   DateTime           @default(now())
  updated_at   DateTime
  itemId       String             @unique
  mm2Giveaways Mm2Giveaway[]
  inventory    UserInventoryMm2[]

  @@index([inGameName])
  @@index([name])
  @@index([rarity])
}

model AmpGiveaway {
  id                 Int                @id @default(autoincrement())
  minWager           Int                @default(0)
  endDate            DateTime
  petId              Int
  value              Int
  Variant            Variant[]
  winnerUsername     String?
  isActive           Boolean            @default(true)
  created_at         DateTime           @default(now())
  updated_at         DateTime           @default(now()) @updatedAt
  pet                pets               @relation(fields: [petId], references: [id])
  winner             User?              @relation("AmpGiveawayWinner", fields: [winnerUsername], references: [username])
  ampGiveawayEntries AmpGiveawayEntry[]

  @@index([id])
  @@index([endDate])
  @@index([endDate, isActive])
}

model AmpGiveawayEntry {
  id           Int         @id @default(autoincrement())
  giveawayId   Int
  userUsername String
  created_at   DateTime    @default(now())
  giveaway     AmpGiveaway @relation(fields: [giveawayId], references: [id], onDelete: Cascade)
  user         User        @relation(fields: [userUsername], references: [username], onDelete: Cascade)

  @@index([giveawayId])
  @@index([userUsername])
}

model Mm2Giveaway {
  id                 Int                @id @default(autoincrement())
  minWager           Int                @default(0)
  endDate            DateTime
  itemId             Int
  value              Int
  winnerUsername     String?
  isActive           Boolean            @default(true)
  created_at         DateTime           @default(now())
  updated_at         DateTime           @default(now()) @updatedAt
  item               Mm2Item            @relation(fields: [itemId], references: [id])
  winner             User?              @relation("Mm2GiveawayWinner", fields: [winnerUsername], references: [username])
  mm2GiveawayEntries Mm2GiveawayEntry[]

  @@index([id])
  @@index([endDate])
  @@index([endDate, isActive])
}

model Mm2GiveawayEntry {
  id           Int         @id @default(autoincrement())
  giveawayId   Int
  userUsername String
  created_at   DateTime    @default(now())
  giveaway     Mm2Giveaway @relation(fields: [giveawayId], references: [id], onDelete: Cascade)
  user         User        @relation(fields: [userUsername], references: [username], onDelete: Cascade)

  @@index([giveawayId])
  @@index([userUsername])
}

model KinguinPromoCode {
  id             String                @id @default(uuid())
  code           String                @unique
  value          Decimal               @db.Decimal(10, 2)
  isRedeemed     Boolean               @default(false)
  redeemedBy     String?
  redeemedAt     DateTime?
  expiresAt      DateTime?
  batchId        String?
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt
  status         KinguinCodeStatus     @default(UNUSED)
  redeemedByUser User?                 @relation("KinguinCodeRedemptions", fields: [redeemedBy], references: [username])
  redemptionLog  KinguinRedemptionLog?

  @@index([code])
  @@index([isRedeemed])
  @@index([redeemedBy])
  @@index([batchId])
}

model KinguinRedemptionLog {
  id            String           @id @default(uuid())
  codeId        String           @unique
  userUsername  String
  ipAddress     String?
  userAgent     String?
  creditsBefore Decimal          @db.Decimal(10, 2)
  creditsAfter  Decimal          @db.Decimal(10, 2)
  creditAmount  Decimal          @db.Decimal(10, 2)
  redeemedAt    DateTime         @default(now())
  code          KinguinPromoCode @relation(fields: [codeId], references: [id], onDelete: Cascade)
  user          User             @relation("KinguinRedemptions", fields: [userUsername], references: [username], onDelete: Cascade)

  @@index([userUsername])
  @@index([redeemedAt])
}

model KinguinCodeBatch {
  id            String   @id @default(uuid())
  batchName     String
  purchaseDate  DateTime
  totalCodes    Int
  totalValue    Decimal  @db.Decimal(10, 2)
  codesRedeemed Int      @default(0)
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([batchName])
  @@index([purchaseDate])
}

model HashChain {
  id              String       @id @default(uuid())
  finalHash       String       @db.VarChar(64)
  clientSeed      String?      @db.VarChar(64)
  clientSeedSetAt DateTime?
  isActive        Boolean      @default(true)
  chainId         String       @unique
  completedAt     DateTime?
  createdAt       DateTime     @default(now())
  currentRound    Int          @default(0)
  gameType        GameType
  isComplete      Boolean      @default(false)
  serverSeed      String       @db.VarChar(128)
  totalRounds     Int          @default(1000000)
  crashRounds     CrashRound[]

  @@unique([gameType, chainId])
  @@index([gameType, isActive])
  @@index([gameType, currentRound])
}

model CrashRound {
  id           String     @id @default(uuid())
  chainId      String
  roundNumber  Int
  gameHash     String     @unique @db.VarChar(64)
  crashPoint   Decimal    @db.Decimal(10, 4)
  clientSeed   String     @db.VarChar(64)
  totalBets    Int        @default(0)
  totalWagered Decimal    @default(0) @db.Decimal(12, 2)
  totalPayout  Decimal    @default(0) @db.Decimal(12, 2)
  createdAt    DateTime   @default(now())
  bets         CrashBet[]
  chain        HashChain  @relation(fields: [chainId], references: [chainId], onDelete: Cascade)

  @@unique([chainId, roundNumber])
  @@index([chainId, roundNumber(sort: Desc)])
  @@index([gameHash])
}

model CrashBet {
  id           String     @id @default(uuid())
  roundId      String
  userUsername String
  betAmount    Decimal    @db.Decimal(10, 2)
  cashoutAt    Decimal?   @db.Decimal(10, 4)
  autoCashout  Decimal?   @db.Decimal(10, 4)
  didCashout   Boolean    @default(false)
  payout       Decimal    @default(0) @db.Decimal(12, 2)
  profit       Decimal    @default(0) @db.Decimal(12, 2)
  createdAt    DateTime   @default(now())
  round        CrashRound @relation(fields: [roundId], references: [id], onDelete: Cascade)
  user         User       @relation("CrashBets", fields: [userUsername], references: [username], onDelete: Cascade)

  @@index([roundId])
  @@index([userUsername, createdAt(sort: Desc)])
}

model UserSeed {
  id                   String                @id @default(uuid())
  userUsername         String                @unique
  activeServerSeed     String                @db.VarChar(128)
  activeServerSeedHash String                @db.VarChar(64)
  activeClientSeed     String                @db.VarChar(64)
  nextServerSeed       String                @db.VarChar(128)
  nextServerSeedHash   String                @db.VarChar(64)
  seedCreatedAt        DateTime              @default(now())
  seedRotatedAt        DateTime?
  lastUsedAt           DateTime              @default(now())
  maxGamesPerSeed      Int                   @default(10000)
  totalGamesPlayed     Int                   @default(0)
  seedHistory          SeedRotationHistory[]
  user                 User                  @relation("UserSeed", fields: [userUsername], references: [username], onDelete: Cascade)

  @@index([userUsername])
}

model SeedRotationHistory {
  id               String           @id @default(uuid())
  userUsername     String
  serverSeed       String           @db.VarChar(128)
  serverSeedHash   String           @db.VarChar(64)
  clientSeed       String           @db.VarChar(64)
  totalGamesPlayed Int
  seedActivatedAt  DateTime
  seedRotatedAt    DateTime         @default(now())
  rotationType     SeedRotationType
  rotationReason   String?
  userSeedId       String?
  firstNonce       Int
  lastNonce        Int
  gameHistory      GameHistory[]
  userSeed         UserSeed?        @relation(fields: [userSeedId], references: [id])
  user             User             @relation("SeedRotationHistory", fields: [userUsername], references: [username], onDelete: Cascade)

  @@index([userUsername])
  @@index([userUsername, seedRotatedAt(sort: Desc)])
  @@index([serverSeedHash])
}

model GameHistory {
  id                    String               @id @default(uuid())
  userUsername          String
  gameId                String               @unique
  seedRotationHistoryId String?
  serverSeedHash        String               @db.VarChar(64)
  clientSeed            String               @db.VarChar(64)
  nonce                 Int
  gameConfig            Json
  gameData              Json
  betAmount             Decimal              @db.Decimal(10, 2)
  finalMultiplier       Decimal              @db.Decimal(10, 4)
  payout                Decimal              @db.Decimal(10, 2)
  profit                Decimal              @db.Decimal(10, 2)
  outcome               GameOutcome
  startedAt             DateTime             @default(now())
  completedAt           DateTime?
  duration              Int?
  gameType              GameType
  seedRotationHistory   SeedRotationHistory? @relation(fields: [seedRotationHistoryId], references: [id])
  user                  User                 @relation("GameHistory", fields: [userUsername], references: [username], onDelete: Cascade)

  @@index([userUsername])
  @@index([userUsername, startedAt(sort: Desc)])
  @@index([gameType])
  @@index([outcome])
  @@index([nonce])
  @@index([serverSeedHash])
  @@index([seedRotationHistoryId])
}

model UserGameStatistics {
  id                String    @id @default(uuid())
  userUsername      String
  totalGames        Int       @default(0)
  totalWagered      Decimal   @default(0) @db.Decimal(12, 2)
  totalPayout       Decimal   @default(0) @db.Decimal(12, 2)
  totalProfit       Decimal   @default(0) @db.Decimal(12, 2)
  gamesWon          Int       @default(0)
  gamesLost         Int       @default(0)
  gamesCashedOut    Int       @default(0)
  biggestWin        Decimal   @default(0) @db.Decimal(10, 2)
  biggestLoss       Decimal   @default(0) @db.Decimal(10, 2)
  highestMultiplier Decimal   @default(0) @db.Decimal(10, 4)
  longestWinStreak  Int       @default(0)
  longestLossStreak Int       @default(0)
  currentStreak     Int       @default(0)
  firstGameAt       DateTime?
  lastGameAt        DateTime?
  updatedAt         DateTime  @updatedAt
  gameType          GameType
  user              User      @relation("UserGameStats", fields: [userUsername], references: [username], onDelete: Cascade)

  @@unique([userUsername, gameType])
  @@index([userUsername])
  @@index([gameType])
  @@index([totalProfit(sort: Desc)])
  @@index([totalWagered(sort: Desc)])
}

model UserDepositAddress {
  id           String           @id @default(uuid())
  userUsername String
  coin         AvailableCryptos
  address      String           @unique
  createdAt    DateTime         @default(now())
  lastUsedAt   DateTime         @default(now())
  isActive     Boolean          @default(true)
  invoiceId    String?
  usedAmount   Decimal?         @db.Decimal(12, 2)
  notes        String?

  user User @relation(fields: [userUsername], references: [username], onDelete: Cascade)

  @@unique([userUsername, coin])
  @@index([address])
  @@index([userUsername])
  @@index([coin])
}

model CryptoTransaction {
  id String @id @default(uuid())

  providerTransactionId String              @unique
  invoiceId             String?           

  txid String

  username String?

  // Currency
  currency             AvailableCryptos
  network              String
  usdAmountPaid         Decimal           @default(0) @db.Decimal(36, 18)
  cryptoAmountPaid      Decimal           @db.Decimal(36, 18)
  coinAmountPaid        Decimal           @db.Decimal(12, 2)

  // Confirmation tracking
  minConfirmations Int     @default(2)
  confirmations    Int     @default(0)
  isFullyConfirmed Boolean @default(false)

  // Status
  status TransactionStatus @default(PENDING)

  // Metadata
  passthrough Json?
  riskLevel   String?
  rawCallback Json?

  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  confirmedAt DateTime?
}
model TransactionHistory {
  id String @id @default(uuid())

  // User
  userUsername String
  user         User   @relation(fields: [userUsername], references: [username], onDelete: Cascade)

  // Transaction type and direction
  category    TransactionCategory
  direction TransactionDirection

  provider   PaymentProviders @default(KINGUIN)

  status TransactionStatus @default(COMPLETED)

  // Value
  usdAmountPaid         Decimal           @default(0) @db.Decimal(36, 18)
  cryptoAmountPaid      Decimal           @db.Decimal(36, 18)
  coinAmountPaid        Decimal           @db.Decimal(12, 2)
  balanceAfter Decimal @db.Decimal(12, 2)

  // Asset details
  assetType   AssetType
  assetSymbol String?

  // Reference to source
  referenceType ReferenceType
  referenceId   String

  // Optional metadata for flexibility
  metadata Json?

  createdAt DateTime @default(now())

  @@index([userUsername])
  @@index([category])
  @@index([referenceId])
  @@index([createdAt])
}

enum PaymentProviders {
  KINGUIN
  UNIWIRE
  INGAME
}
enum TransactionCategory {
  CRYPTO
  KINGUIN_REDEEM
  PET
  REFUND
}

enum AssetType {
  CRYPTO
  GIFT_CARD
  ITEM
}

enum ReferenceType {
  CRYPTO_TRANSACTION
  KINGUIN_CODE
  INVENTORY_ITEM
  GAME_HISTORY
  TIP_TRANSACTION
}

enum TransactionDirection {
  IN
  OUT
}
enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELED
}
enum AvailableCryptos {
  BTC
  ETH
  LTC
  USDT
  DOGE
}

enum GameType {
  CRASH
  MINES
}

enum GameOutcome {
  WON
  LOST
  CASHED_OUT
  CANCELLED
  PLAYING
}

enum SeedRotationType {
  MANUAL
  AUTOMATIC
  CLIENT_SEED_CHANGE
  SYSTEM
  ADMIN
}

enum KinguinCodeStatus {
  UNUSED
  REDEEMED
  EXPIRED
  DISABLED
}

enum ReferralClaimLogStatus {
  SUCCESS
  PENDING
  FAILED
  CANCELED
}

enum Side {
  H
  T
}

enum UserInventoryItemState {
  WITHDRAWING
  IDLE
  BATTLING
  LOCKED
}

enum Variant {
  M
  N
  F
  R
}

enum UserRoles {
  ADMIN
  MODERATOR
  SUPPORT
  MEMBER
  OWNER
  COMMUNITY_MANAGER
  WHALE
  BIGFLIPPER
}

enum BotTradeStatus {
  NONE
  WITHDRAW_ACCEPTED
}
